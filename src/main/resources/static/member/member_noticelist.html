<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>member_blacklist</title>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=ABeeZee&amp;display=swap">
    <link rel="stylesheet" href="../fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../css/Carousel-Hero.css">
    <link rel="stylesheet" href="../css/Footer-with-social-media-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="../css/Main-Content.css">
    <link rel="stylesheet" href="../css/Navbar-Centered-Brand.css">
    <link rel="stylesheet" href="../css/Profile-Edit-Form-1.css">
    <link rel="stylesheet" href="../css/Profile-Edit-Form.css">
    <link rel="stylesheet" href="../css/Profile-with-data-and-skills.css">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        table.table {
            table-layout: fixed;
        }

        div.row {
            width: 100%;
        }

        div.message_button {
            width: fit-content;
            margin-left: 600px;
        }

        span.message_button {
            width: fit-content;
            margin-right: 15px;
        }

        th#notice_id {
            width: 50px;
        }

        td#notice_id {
            visibility: hidden;
            width: 50px;
        }

        th#time {
            width: 200px;
            text-align: center;
        }

        td#time {
            width: 200px;
            text-align: center;
            vertical-align: middle;
        }

        th#notice_content {
            text-align: center;
            width: 320px;
        }

        td#notice_content {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 320px;
            vertical-align: middle;
        }

        th#is_read {
            width: 30px;
            font-size: 0px;
        }

        td#is_read {
            width: 30px;
            font-size: 0px;
            height: 30px;
        }

        div#is_read[value='1'] {
            background-color: red;
            margin: 15px 0;
            width: 18px;
            height: 18px;
            border-radius: 10px;
        }

        th#manage_function {
            width: 200px;
            text-align: center;
        }

        td#manage_function {
            text-align: center;
            width: 200px;
            vertical-align: middle;
        }

        input#search {
            width: 200px;
            margin: auto;
            display: inline-block;
        }

        button {
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5)
        }
    </style>
</head>

<body>
<header>
    <nav class="navbar navbar-light navbar-expand-md py-3" style="background: #82d6bd;height: 120px;">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center"></a>
            <a href="../index.html" style="width: 180px;height: 103.19px;">
                <img data-bss-hover-animate="pulse" src="../img/Logo-removebg.png" style="width: 100%;">
            </a>
            <button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-2">
                <span class="visually-hidden">Toggle navigation</span>
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navcol-2" style="font-weight: bold;height: 100px;">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item" id="shop">
                        <a class="nav-link active" data-bss-hover-animate="pulse" href="../shop/shopIndex(Vue).html"
                           style="border-width: 20px;margin-top: 10px;">
                            <img src="../img/gamepad-solid.svg">商城中心
                        </a>
                    </li>
                    <li class="nav-item" id="shshop">
                        <a class="nav-link" data-bss-hover-animate="pulse" href="../sh_shop/sh_MainView.html"
                           style="border-width: 20px;margin-top: 10px;color: var(--bs-dark);">
                            <img src="../img/dice-solid.svg">二手商城
                        </a>
                    </li>
                    <li class="nav-item" id="actitcle">
                        <a class="nav-link align-items-xl-center" data-bss-hover-animate="pulse"
                           style="border-width: 20px;margin-top: 11px;color: var(--bs-dark);" href="../acticle/article_main.html">
                            <img class="d-flex mx-auto" src="../img/newspaper-regular.svg"
                                 style="height: 50px;">論壇社群
                        </a>
                    </li>
                    <li class="nav-item" id="activty">
                        <a class="nav-link" data-bss-hover-animate="pulse" href="../activity/act_finder.html"
                           style="border-width: 20px;margin-top: 10px;color: var(--bs-dark);">
                            <img src="../img/champagne-glasses-solid.svg">活動專區
                        </a>
                    </li>
                    <li class="nav-item" id="member_home">
                        <a class="nav-link active" data-bss-hover-animate="pulse" href="member_home.html"
                           style="margin-top: 10px;">
                            <img class="d-flex mx-auto align-items-xl-center" src="../img/user-solid.svg"
                                 style="height: 50px;">會員中心
                        </a>
                    </li>
                    <li class="nav-item logout">
                        <a class="nav-link fs-6 text-center" data-bss-hover-animate="pulse" id="sign_out"
                           style="margin-top: 0px;color: var(--bs-dark);width: 80px;height: 100px;">
                            <div id="member_pic-1" class="avatar-bg center"
                                 style="width: 60px;height: 60px;margin-left: 0px;"></div>
                            登出
                        </a>
                    </li>
                </ul>
                <footer id="footerpad-1"></footer>
            </div>
        </div>
    </nav>
</header>

<div class="main-content">
    <div class="row" style="height: 800px;">
        <div class="col-lg-4 col-xl-2 offset-xl-1" style="height: 600px;">
            <div class="list-group" >
                <a data-bss-hover-animate="pulse" id="info"
                   class="list-group-item list-group-item-action"
                   href="./member_info.html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">基本資料管理
                </a>
                <a data-bss-hover-animate="pulse" id="trade" class="list-group-item list-group-item-action"
                   href="./member_order_list(Vue).html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">查詢一般交易
                </a>
                <a data-bss-hover-animate="pulse" id="sh_trade" class="list-group-item list-group-item-action"
                   href="./member_shordersearch.html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">查詢二手交易
                </a>
                <a data-bss-hover-animate="pulse" id="sh_buy" class="list-group-item list-group-item-action"
                   href="./SecondHand_buylist_search.html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">查詢二手收購進度
                </a>
                <a data-bss-hover-animate="pulse" id="pro_follow" class="list-group-item list-group-item-action"
                   href="./member_product_follow(Vue).html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">一般商品追蹤清單
                    <br>
                </a>
                <a data-bss-hover-animate="pulse" id="sh_follow" class="list-group-item list-group-item-action"
                   href="./member_shloveList.html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">二手商品追蹤清單
                </a>
                <a data-bss-hover-animate="pulse" id="act_follow" class="list-group-item list-group-item-action"
                   href="./act_report_mem.html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">查詢參加活動
                </a>
                <a data-bss-hover-animate="pulse" id="notice" class="list-group-item list-group-item-action"
                   href="member_noticelist.html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">查看通知
                </a>
                <a data-bss-hover-animate="pulse" id="login_his" class="list-group-item list-group-item-action"
                   href="member_loginhistory.html" data-bs-toggle="list"
                   style="background: var(--bs-light);border-top-color: var(--bs-gray-400);border-bottom-color: var(--bs-gray-400);">查看登入紀錄
                </a>
            </div>
        </div>
        <div class="col">
            <div class="container profile profile-view" id="profile" style="height: 800px;">
                <h1>查看通知</h1>
                <div class="message_button">
<!--                        <span class="message_button">-->
<!--                            <input class="form-control" type="text" id="search" name="search">-->
<!--                        </span>-->
<!--                    <span class="message_button">-->
<!--                            <img src="../img/magnifying-glass-solid.svg" style="width: 20px;">-->
<!--                        </span>-->
                    <span class="message_button">
                            <button type="button" class="have_read btn btn-primary readAll">已讀所有通知</button>
                        </span>
                    <span class="message_button">
                            <button type="button" class="have_read btn btn-primary removeAll">刪除所有通知</button>
                        </span>
                </div>
                <table class="table">
                    <thead>
                    <tr>
                        <th scope="col" id="notice_id"></th>
                        <th scope="col" id="time">通知時間</th>
                        <th scope="col" id="notice_content">通知內容</th>
                        <th scope="col" id="is_read"></th>
                        <th scope="col" id="manage_function">管理功能</th>
                    </tr>
                    </thead>
                    <tbody id="noticeTable"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<footer id="footerpad">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-lg-8 mx-auto">
                <ul id="noticeList" class="list-inline text-center">
                    <li class="list-inline-item">
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#"></a>
                    </li>
                </ul>
                <p class="copyright text-muted text-center">Copyright © NBP.gg 2023 | Web Design by Designer</p>
            </div>
        </div>
    </div>
</footer>
<script src="../jquery/jquery-3.4.1.min.js"></script>
<!-- <script src="../bootstrap/js/bootstrap.min.js"></script> -->
<script src="../js/bs-init.js"></script>
<script src="../js/Profile-Edit-Form.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>
</body>
<script src="../js/member_logout.js"></script>
<script>


    $(window).on("load", function () {
        $.ajax({
            url: "memberGetNoticeServlet",
            method: "POST",
            dataType: "json",
            success: function (response) {
                // let aaa = response;
                render(response);
            }
        })
    })


    function render(notice) {
        $('#noticeTable').remove();
        const tbody = document.createElement('tbody');
        tbody.setAttribute('id', 'noticeTable');

        for (let i = 0; i < notice.length; i++) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
            <td id="notice_id">${notice[i].notice_id}</td>
            <td id="time">${notice[i].notice_time}</td>
            <td id="notice_content">${notice[i].notice_value}</td>
            <td id="is_read"><div id="is_read" value=${notice[i].is_read}></div></td>
            <td id="manage_function">
            <button type="button" class="btn btn-warning remove">刪除通知</button>`
            tbody.append(tr);
        }
        $('.table').append(tbody);
    }

    $(document).on("click", "button.remove", function (e) {
        const notice_id = $(this).closest("tr").find("td#notice_id").text();
        Swal.fire({
            title: '確定刪除?',
            text: "確定刪除此筆通知?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'DELECT'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire(
                    '刪除成功!',
                    'success'
                ).then((result) => {
                        $(e.target).closest("tr").remove();
                    },
                    $.ajax({
                        url: "removeOneNoticeServlet",
                        method: "POST",
                        dataType: "json",
                        data: {
                            notice_id: notice_id,
                        }
                    })
                )
            }
        })
    })

    $(document).on("click", "button.removeAll", function () {
        Swal.fire({
            title: '確定刪除?',
            text: "確定刪除全部通知?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'DELECT'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire(
                    '刪除成功!',
                    'success'
                ).then((result) => {
                        $.ajax({
                            url: "removeAllNoticeServlet",
                            method: "POST",
                            dataType: "json",
                            success: function () {
                                window.location.href = "member_noticelist.html";
                            }
                        })
                    }
                )
            }
        })
    })

    $(document).on("click", "td#notice_content", function () {
        const message = $(this).closest("tr").find("td#notice_content").text();
        const isRead = $(this).closest("tr").find("div#is_read").attr("value");
        const notice_id = $(this).closest("tr").find("td#notice_id").text();
        Swal.fire({
            title: '通知內容',
            text: message,
        }).then((result) => {
            $(this).closest("tr").find("div#is_read").attr("value", 0);
            $.ajax({
                url: "readOneNoticeServlet",
                method: "POST",
                dataType: "json",
                data: {
                    notice_id: notice_id
                },
            })
        })
    })

    $(document).on("click", "button.readAll", function (){
        $.ajax({
            url: "readAllNoticeServlet",
            method: "POST",
            dataType: "json",
            success:function (){
                window.location.href = "member_noticelist.html";
            }
        })
    })

</script>

</html>