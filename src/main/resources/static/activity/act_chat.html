<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="../css/act_chat.css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
          integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="stylesheet" href="../css/act_iron_chat.css">
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
    <!-- header -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=ABeeZee&amp;display=swap">
    <link rel="stylesheet" href="../fonts/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
    <!-- <link rel="stylesheet" href="./css/Footer-with-social-media-icons.css"> -->

    <style>
        .self-message {
            text-align: right;
            background-color: lightblue;
        }
        .other-message {
            text-align: left;
            background-color: lightgreen;
        }
    </style>
    <style>
        .custom-alert {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
        }

        .custom-alert-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: white;
            text-align: center;
            border-radius: 5px;
        }

        .btn-wrapper {
            margin-top: 20px;
        }

        .btn-wrapper button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>

</head>

<body>
<header>


    <link href="https://fonts.googleapis.com/css?family=DM+Sans:400,500,700&display=swap" rel="stylesheet">
    <div class="app-container">
        <button class="mode-switch">
            <svg class="sun" fill="none" stroke="#fbb046" stroke-linecap="round" stroke-linejoin="round"
                 stroke-width="2" class="feather feather-sun" viewBox="0 0 24 24">
                <defs />
                <circle cx="12" cy="12" r="5" />
                <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
            </svg>
            <svg class="moon" fill="none" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round"
                 stroke-width="2" class="feather feather-moon" viewBox="0 0 24 24">
                <defs />
                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
            </svg>
        </button>
</header>

<link href="https://fonts.googleapis.com/css?family=DM+Sans:400,500,700&display=swap" rel="stylesheet">
<div class="app-container">
    <button class="mode-switch">
        <svg class="sun" fill="none" stroke="#fbb046" stroke-linecap="round" stroke-linejoin="round"
             stroke-width="2" class="feather feather-sun" viewBox="0 0 24 24">
            <defs />
            <circle cx="12" cy="12" r="5" />
            <path
                    d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
        </svg>
        <svg class="moon" fill="none" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round"
             stroke-width="2" class="feather feather-moon" viewBox="0 0 24 24">
            <defs />
            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
        </svg>
    </button>


    <div class="app-main" id="app-main">
        <div class="video-call-wrapper">
            <div class="video-participant">
                <div class="participant-actions">
                </div>
                <img src="../img/img_act/2.jpeg" id="actImage"  alt="participant">
            </div>
        <div class="chat-container">
            <div class="chat-header">
                <img id="imgId" src="" alt="participant">

            </div>

    </div>

        </div>
        <div id="custom-alert" class="custom-alert">
            <div class="custom-alert-content">
                <p>您確定要執行此操作嗎？</p>
                <div class="btn-wrapper">
                    <button id="confirm-button">確定</button>
                    <button id="cancel-button">取消</button>
                </div>
            </div>
        </div>

        <div class="video-call-actions">
            <div class="btnI2">
                <a href="/gg4nbp/activity/act_report_list.html" onclick="return showConfirmation();">
                    <i class="fas fa-radiation"></i>
                    <input type="button" value="" class="ctrlbutton">
                </a>
            </div>
            <div class="btnI4">
                <a href="/gg4nbp/activity/act_finder.html" onclick="return showConfirmation();">
                    <i class="fas fa-sign-out-alt"></i>
                    <input type="button" value="" class="ctrlbutton">
                </a>
            </div>
        </div>
    </div>
    <div class="right-side">
        <button class="btn-close-right">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
                 stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="feather feather-x-circle"
                 viewBox="0 0 24 24">
                <defs></defs>
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M15 9l-6 6M9 9l6 6"></path>
            </svg>
        </button>
        <div class="chat-container">
            <div class="chat-header">
                <img
                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVR4nO2UvUoDQRSFP7BOlU4wKYOWaY2tNnmBvIMiaKlPkjadBCxjfip9Fu0UjDYrYmTgZlknd2d3ZkdCYD+4xe6ce84sd2egpkbnEniRuiACbWABfAJzoKVoToBVpn6AXqBXysIynbHJtaUxdRXolfJhiZds0lO++DjQK2Vecpdmrs9S5xW90rnMZLfTorkUENNruxwAY5mZqXugU9W0XXAETOir8le/yZqPl9cRGCuh67qrcpwSS2yesywdwe+eXn/QDIvWfbS5rP65diM4FC+vRBGPgAHQLBHWFO1I8Ulcjfb9mq1v4MbReyuavP6pK9gc8gfgK6fZteu8HvN+olwwKnvAPtAF+sCwxJzW60Pp6YqH8QrmzCP4lIgceQQfxgxueAQbbVSegMcK6zVshV91ovgE2+W+PAAAAABJRU5ErkJggg==">
                <button class="chat-header-button" id ="actName" >悠久的回憶以重現此刻為浮生一霎</button>
            </div>
            <div class="chat-area" id="chat">
                <div class="message-wrapper">
                    <div class="profile-picture"></div>
                    <div class="message-content"></div>
                </div>
            </div>

            <div class="message-wrapper reverse">
                <div class="profile-picture">
                     </div>
               </div>
        </div>
        <div class="chat-typing-area-wrapper">
            <div class="chat-typing-area">
                <input type="text" id="message" placeholder="在此輸入嘴砲" class="chat-input">
                <button class="send-button" id="send">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"
                         viewBox="0 0 24 24">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>
</div>
<button class="expand-btn">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
         class="feather feather-message-circle">
        <path
                d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
    </svg>
</button>
</div>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
    <iframe width="560" height="315" src="https://www.youtube.com/embed/o0Zi3vN6ncU?autoplay=1&loop=1&playlist=o0Zi3vN6ncU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>


<footer id="footerpad">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-lg-8 mx-auto">
                <ul class="list-inline text-center">
                    <li class="list-inline-item">
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li class="list-inline-item"><a href="#"></a>
                    </li>
                </ul>/
                <p class="copyright text-muted text-center">Copyright © NBP.gg 2023 | Web Design by Designer</p>
            </div>
        </div>
    </div>

    <script>

        var username = prompt("請輸入你的暱稱", "Username");

        // 提取URL中的聊天室ID
        let params = new URLSearchParams(window.location.search);
        let roomId = params.get('no'); // 從URL查詢參數獲取ID

        // 建立WebSocket連接時，將聊天室ID傳遞給伺服器
        var host = window.location.host;
        var protocol = window.location.protocol.replace("http", "ws"); // 如果是https协议，替换为wss
        var socketUrl = protocol + "//" + host + "/gg4nbp/socket/" + roomId + "/" + username;

        var socket = new WebSocket(socketUrl);

        var chat = document.getElementById('chat');
        var onlineUsers = document.getElementById('onlineUsers');
        var message = document.getElementById('message');
        var send = document.getElementById('send');

        socket.addEventListener('open', function() {
            console.log('WebSocket is connected.');
        });

        socket.addEventListener('close', function() {
            console.log('WebSocket is closed.');
        });

        socket.addEventListener('error', function(event) {
            console.log('WebSocket Error: ' + event.error);
        });

        socket.addEventListener('message', function(event) {
            console.log('Server: ' + event.data);
            var data = JSON.parse(event.data);
            if (data.hasOwnProperty('userlist')) {
                onlineUsers.innerHTML = '';
                data.userlist.forEach(function(user) {
                    onlineUsers.innerHTML += '<p>' + user + '</p>';
                });
            } else {
                displayMessage(data.username, data.message);

                // 將聊天訊息傳入Redis
                saveChatMessage(data.username, data.message);
            }
        });

        send.onclick = function() {
            var text = message.value;
            var msg = JSON.stringify({username: username, message: text});
            socket.send(msg);
            message.value = '';
        };

        function displayMessage(messageUsername, message) {
            var messageClass = (messageUsername === username) ? 'self-message' : 'other-message';
            chat.innerHTML += '<p class="' + messageClass + '">' + messageUsername + ': ' + message + '</p>';
        }

        function saveChatMessage(username, message) {
            // 將聊天訊息傳入後端處理，存入Redis
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/saveChatMessage', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify({username: username, message: message}));

        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="../jquery/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script src="../js/act_chat.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script>
    params = new URLSearchParams(window.location.search);
    let id = params.get('no'); // 從URL查詢參數獲取ID


    $(document).ready(function(){
        $.ajax({
            url: "/gg4nbp/act/" + id,
            type: "GET",
            success: function(act){
                let imgPath = decodeURIComponent(act.actImage);
                $('#actImage').attr('src', imgPath);
                $('#actName').text(act.actName);
            },
            error: function(error){
                console.log(error);
            }
        });
    });
</script>

    <script>
        function showConfirmation() {
            event.preventDefault();
            document.getElementById("custom-alert").style.display = "block";

            // 取得當前點擊的按鈕 URL
            var buttonUrl = event.currentTarget.getAttribute("href");

            // 呈現自訂的 Alert 彈窗
            document.getElementById("custom-alert").style.display = "block";

            // 綁定按鈕點擊事件
            document.getElementById("confirm-button").addEventListener("click", function() {
                confirmAction(buttonUrl);
            });
            document.getElementById("cancel-button").addEventListener("click", cancelAction);
        }

        function confirmAction(url) {
            window.location.href = url;
        }

        function cancelAction() {
            document.getElementById("custom-alert").style.display = "none";
        }
    </script>


</body>

</html>